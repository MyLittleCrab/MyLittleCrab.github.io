{"pageProps":{"allPosts":[{"title":"Пробросить VPN+RDP подключение на домашний компьютер: пособие для маленьких и тупых","date":"2021-06-11T19:06:05.108Z","slug":"hamachi-on-chromebooks","author":{"name":"Roman A. Nosov","picture":"https://avatars3.githubusercontent.com/u/21103635?s=120&v=4","url":"https://github.com/JustAddAcid"},"content":"\nТак уж вышло, что бывает нужно с работы/поездки/откуда-то_ещё подключаться к домашнему компьютеру. Например, чтобы показать свой проект на презентации. Или подключиться к локальному сервису, развернутому на машине.\n\nНо что, если ситуация усложняется тем, что ты дурак и купил хромбук вместо нормального устройства?\n\n![Chromebook meme](../public/assets/blog/hamachi-on-chromebooks/chromebooks.jpg)\n\nВыход через оконный проём всегда имеется. И даже есть простой и понятный путь решения задачи: развернуть *l2tp/ipsec* VPN-сервер (например, великолепный [SoftEtherVPN](https://www.softether.org/)), который бы торчал наружу, и подключить к нему все необходимые устройства. \n\nБолее того, **именно такая схема** у меня и была раньше. *(Пока я не забывал платить за VDS)*\n\n## Ковальски, варианты!\n\nЕсть максимально **тупой и небезопасный** путь: вытащить из-за **NAT/фаерволов** \"*наружу*\" домашний компьютер и подключать напрямую. Но если комплюхтер на шиндоусе, все мы с вами знаем, с какой скоростью к нему получит доступ кто-нибудь ещё... \n\nКакой-нибудь абстрактный лейтенант *КейДжиБи* спустя несколько секунд сделает из домашнего компьютера хранилище **ц**ентральных **п**роцессоров. И меня же за это набутылит. \n\n## А есть какой-то VPN для бедных?\n\nМне вспомнился легендарный сервис, который знал каждый школьник моего детства. Именно через него играли во всякие доты, контерстрайки, и [убойные дела](https://smallgames.ws/18239-uboijnoe-delo.html) — [Hamachi](https://www.vpn.net/).\n\nС тех пор, как я им в последний раз пользовался, он сильно коммерциализировался и стал ограничивать сети лишь 5-ю устройствами, а за увеличение лимита вымогать деньги. Довольно мерзко, но для личного использования должно хватить. \n\nСуть этой софтины в том, что она *не предоставляет* VPN-сервер в классическом понимании (не пропускает весь шифрованный трафик через себя). А лишь *\"знакомит\"* устройства сети друг с другом, и помогает им поднять **P2P** подключение. Т.е. пинг и скорость подключения будут ровно такими же, как если бы устройства подключались напрямую без дополнительного софта. Но при этом устройства будут продолжать быть глубоко за NAT и быть недоступны для внешних глаз. \n\n## А дальше что?\n\nСоздать аккаунт и свою приватную сеть на [официальном сайте](https://www.vpn.net/) элементарно. Но для меня оставалось загадкой: смогу ли я подключиться к этой сети со своего экзотического хромбука?\n\nНайти клиент под windows не составляет труда. А вот страница скачивания ARM-linux-клиента меня встретила вот таким выбором:\n\n![Выбор клиента под ARM](../public/assets/blog/hamachi-on-chromebooks/hamachi.png)\n\nВо-первых, вы узнаём, что билд под **ARM** до сих пор остаётся в *beta*. Но мы не будем использовать его в *production*, так ведь? :) Во-вторых, мне предлагают выбрать между **ARMEL** и **ARMHF** версиями. И тут я впервые столкнулся с этими аббревиатурами. \n\n[Быстрым гуглением выяснилось](https://linuxhint.com/about-arm64-armel-armhf/), что **ARMHF** — это процессоры с хардварным обработчиком операций над *floating-point-числами*, а **ARMEL**, соответственно, софтверным. \n\nПоскольку я живу в 2021 году, то выбрал deb-пакет с ARMHF. Но при установке меня ждало следующее испытание:\nустановщик сваливался с ошибкой, где ругался на то, что архитектура ARM64 != ARMHF. \n\n## Що робити? Гуглити!\n\n[Вот тут](https://community.logmein.com/t5/LogMeIn-Hamachi-Discussions/Hamachi-for-ARM-HF-getting-error-167-while-trying-to-connect-to/td-p/138634) нашел возможное решение. Там юзверь смог установить и запустить ARMHF-версию после того, как добавил эту архитектуру в **dpkg** и установил для неё libc6 и libstdc.\n\n```bash\nsudo dpkg —add-architecture armhf\nsudo apt-get update\nsudo apt-get install libc6:armhf\nsudo ln -s /lib/ld-linux-armhf.so.3 /lib/ld-linux.so.3\nsudo apt-get install libstdc++6:armhf\n```\n\nПосле таких танцев с бубном deb-пакет с hamachi успешно устанавливается. Осталось подключиться к созданной ранее сети:\n\n```bash\nsudo /etc/init.d/logmein-hamachi start\nsudo hamachi set-nick chromebook\n# sudo hamachi join %network id% %network password% у меня (как и у того пользователя) не завелось\n# возвращая безымянную ошибку #167 \n# но можно привязать свой аккаунт logmein к этому клиенту. И подключиться к сети через веб-интерфейс\nsudo hamachi attach %почта, используемая при регистрации%\n```\n\nПосле этого в [личном кабинете](https://www.vpn.net/) появится запрос на подключение клиента. Нужно его подтвердить и привязать к сети. На этом любопытная часть закончилась. VPN на хромбуке поднят. Если всё пошло, как и ожидалось — в терминале мы должны видеть примерно следующее:\n\n```bash\nsudo hamachi \n  # version    : 2.1.0.203\n  # pid        : 1150\n  # status     : logged in\n  # client id  : XXX-XXX-XXX\n  # address    : XXX.XXX.XXX.XXX    %ipv6addr%\n  # nickname   : chromebook\n  # lmi account: %your email%\nsudo hamachi list\n#  * [XXX-XXX-XXX]%network name%  capacity: 1/5, subscription type: Free, owner: %your email%\nip addr show\n# >> Появился интерфейс\n#3: ham0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1404 qdisc pfifo_fast state UNKNOWN group default qlen 1000\n```\n\n## На стороне домашнего компьютера\n\nПодключение к Hamachi из-под windows-x64 происходит без каких-либо дополнительных сложностей: просто скачиваем клиент, запускаем, логинимся, радуемся поднятым VPN.\n\n## Поднимаем RDP сервер\n\n### А нахрена?\n\nКонечно, для простого удалённого управления можно воспользоваться **Chrome Remote Desktop**. Но в нём очень куцая функциональность. Например, он не может шарить буфер обмена, файлы и подключенные по USB устройства между компьютерами. А классический RDP делает это элементарно из коробки. \n\nЧто ж. Чтобы включить RDP сервер на PRO* версиях windows, нужно лишь нажать на переключатель в настройках. Но если вы  ~~жадный русский~~ бедный житель страны третьего мира, то внезапно можете обнаружить вот такую заглушку:\n\n![Windows 10 home: try to enable RDP server](../public/assets/blog/hamachi-on-chromebooks/rdp_not_working.png)\n\nПо умолчанию в эту сборку не входит RDP сервер. Но есть замечательный проект на гитхабе, который поможет решить проблему: [RDPWrap](https://github.com/stascorp/rdpwrap). Сия шайтан-софтина не очень friendly в установке и у меня завелась только после такого алгоритма действий ([который я подсмотрел здесь](https://github.com/stascorp/rdpwrap/issues/999)):\n\n* Скачал релиз в zip (а не инсталлятор)\n* Добавил папку с распакованными файлами в исключения защитника шиндовс\n\n![Исключение защитника](../public/assets/blog/hamachi-on-chromebooks/exceptions_microsoft_guard.png)\n\n* Запустил install-скрипт\n* Погасил сервер\n* Заменил ini-файл [на тот, что здесь](https://raw.githubusercontent.com/affinityv/INI-RDPWRAP/master/rdpwrap.ini).\n* Запустил сервис\n\n```bash\ninstall.bat\nnet stop termservice\n# Подменил ini-файл в директории C:\\Program Files\\RDP Wrapper\\rdpwrap.ini\nnet start termservice\n```\n* ...\n* PROFIT!\n\n![PROFIT](../public/assets/blog/hamachi-on-chromebooks/profit.jpg)\n\n## Всо\n\nНа этом этапе должно уже всё заработать. Из-под хромбука по RDP можно подключаться через [FreeRDP](https://www.freerdp.com/) клиент, который есть в apt и уже был [описан вот здесь](./remote-workplace-linux).\n\nК остальным поднятым сервисам можно будет \"достучаться\" так же, как если бы компьютеры были в локальной сети. ¯\\\\_(ツ)_/¯\n\n<iframe frameborder=\"0\" style=\"border:none;width:100%;height:180px;\" width=\"100%\" height=\"180\" src=\"https://music.yandex.ru/iframe/#track/76128507/13437222\">Слушайте <a href='https://music.yandex.ru/album/13437222/track/76128507'>Веснянка</a> — <a href='https://music.yandex.ru/artist/4827898'>Go_A</a> на Яндекс.Музыке</iframe>\n\n#linux #танцы_с_бубном #vpn","ogImage":{"url":"/assets/blog/hamachi-on-chromebooks/background.jpg"},"coverImage":"/assets/blog/hamachi-on-chromebooks/background.jpg","issueId":"21","excerpt":"Так уж вышло, что часто бывает нужно с работы/поездки/откуда-то ещё подключаться к домашнему компьютеру. Например, чтобы показать свой проект на презентации. Но что, если ситуация усложняется тем, что ты дурак и купил хромбук вместо нормального устройства?"}],"tag":"vpn"},"__N_SSG":true}