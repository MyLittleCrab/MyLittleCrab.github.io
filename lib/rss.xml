<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Nosov Blog]]></title><description><![CDATA[Obsidian digital garden]]></description><link>https://nosoff.info/</link><image><url>https://nosoff.info/lib/media/favicon.png</url><title>Nosov Blog</title><link>https://nosoff.info/</link></image><generator>Webpage HTML Export plugin for Obsidian</generator><lastBuildDate>Fri, 12 Jul 2024 19:51:39 GMT</lastBuildDate><atom:link href="https://nosoff.info/lib/rss.xml" rel="self" type="application/rss+xml"/><pubDate>Fri, 12 Jul 2024 19:51:37 GMT</pubDate><copyright><![CDATA[Roman A. Nosov]]></copyright><ttl>60</ttl><dc:creator>Roman A. Nosov</dc:creator><item><title><![CDATA[Как заворачивать трафик в VPN на уровне роутера]]></title><description><![CDATA[ 
 <br>Может пригодиться для ситуаций, когда нужно подключиться к рабочему VPN, но подключения за пределами страны заблокированы админами. И получается, что нужен первый впн, который "забрасывает" трафик в нужную страну, и второй -- тот самый рабочий. <br>Или если ты находишься в России, и хочешь фрилансить на Upwork. Ибо в апворк запрещено заходить из "токсичных стран". И клиент апворка проверяет -- установлены ли VPN программы на твоём ПК.<br>&lt;TL;DR&gt;<br><br><br>
<br>Джедай домогается до всех магазинов электроники, и пытается выцепить роутер, который из-коробки поддерживает подключение по openVPN. (Их мало, они дорогие)
<br>Джедай берет из кладовки свой старый роутер, ставит на него Linux, и полноценный клиент openVPN.
<br>Первый путь слишком скучный, и вы с ним без меня справитесь. <br><br>Для этого берем и вбиваем его модель на <a data-tooltip-position="top" aria-label="https://firmware-selector.openwrt.org/" rel="noopener" class="external-link" href="https://firmware-selector.openwrt.org/" target="_blank">вот этом сайте</a>. Нашлось? Пол дела сделано! <br>Важно ещё не только модель роутера проверять, но и номер ревизии модели. Потому что иногда производители в одну и ту же модельку пихают совершенно разное железо, и если залить от другой ревизии, то у нас ничего не встанет. <br>Если не нашлось, то увы, придётся топать в магазин. Обзаведясь списком поддерживаемых устройств.<br>
(на самом деле, поддерживаются где-то 70% всех роутеров. Но на всякий случай полный список <a data-tooltip-position="top" aria-label="https://openwrt.org/supported_devices" rel="noopener" class="external-link" href="https://openwrt.org/supported_devices" target="_blank">вот тут</a>. А рекомендованные устройства <a data-tooltip-position="top" aria-label="https://openwrt.org/toh/recommended_routers" rel="noopener" class="external-link" href="https://openwrt.org/toh/recommended_routers" target="_blank">вот тут</a>.)<br><br>Если вы ещё не поняли, ставить будем именно эту сборку линукса для роутеров. Потому что у него есть удобная вебморда. Почти как стоковая, только лучше :)<br>Возвращаемся на сайт, <a data-tooltip-position="top" aria-label="https://firmware-selector.openwrt.org/" rel="noopener" class="external-link" href="https://firmware-selector.openwrt.org/" target="_blank">где мы проверяли модель роутера</a>. Видим внизу ссылки для скачивания сборок OpenWRT для нашей модели.<br>
<img alt="Assets/Pasted image 20240712215939.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712215939.png"><br>Kernel и Sysupgrade нас не интересует. Нас интересует третий вариант, который будет называться по разному в зависимости от доступного на нашей модели способа установки. <br><br>
<br>Зайти в вебморду роутера, и во вкладке "обновление ПО" подсунуть ему сборку openWRT.
<br>Расшарить папку по TFTP, положить в неё openWRT и перезагрузиться
<br>Колдовать с serial-портом и консолью
<br><br>Скачал образ openWRT. И на всякий случай открыл WIKI по установке конкретно от моей модели роутера. У меня в шкафу валялся <a data-tooltip-position="top" aria-label="https://www.tp-link.com/ru/home-networking/wifi-router/tl-wr840n/" rel="noopener" class="external-link" href="https://www.tp-link.com/ru/home-networking/wifi-router/tl-wr840n/" target="_blank">TL-WR840N v4</a>.<br><a data-tooltip-position="top" aria-label="https://openwrt.org/toh/tp-link/tl-wr840n_v4" rel="noopener" class="external-link" href="https://openwrt.org/toh/tp-link/tl-wr840n_v4" target="_blank">Вики от него</a><br>На вики видно, что единственный способ как накатить на него WRT, это через расшаривание по TFTP с IP 192.168.0.66 и файл должен называться tp_recovery.bin<br>
<img alt="Assets/Pasted image 20240712220921.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712220921.png"><br><br>Из шкафа достаём небольшой ethernet кабель, втыкаем один конец в компьютер, второй в роутер. Отключаем dhcp на роутере (но скорее всего и без отключение заведётся).<br>И выставляем нашему компьютеру нужный IP:<br>
Тыкаем на иконку нашей сети в трее, далее "Параметры сети и Интернет"<br>
<img alt="Assets/Pasted image 20240712221325.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712221325.png"><br>Далее в открывшемся окне "Ethernet" -&gt; "Настройка параметров адаптера"<br><img alt="Assets/Pasted image 20240712221509.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712221509.png"><br>Далее из всех появившихся в том числе виртуальных подключений нужно найти нашу физическую сетевую карту. Обычно рядом с ней пишется номер модели.<br>Открываем её свойства.<br>
<img alt="Assets/Pasted image 20240712221805.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712221805.png"><br>И в свойствах IP версии 4 прописываем нужный нам IP адрес из вики<br>
<img alt="Assets/Pasted image 20240712221847.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712221847.png"><br>Для расшаривания папки будем использовать софтинку <a data-tooltip-position="top" aria-label="https://pjo2.github.io/tftpd64/" rel="noopener" class="external-link" href="https://pjo2.github.io/tftpd64/" target="_blank">tftpd64</a>. Качаем, распаковываем себе куда-нибудь на рабочий стол.<br>Рядом создаём какую-нибудь папку, в которую кладём скачанную ранее сборку openWRT и переименовываем файл в tp_recovery.bin.<br><img alt="Assets/Pasted image 20240712222325.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712222325.png"><br>Открыв программу от имени администратора выбираем папку, которую хотим расшарить, сетевую карту, по которой будет передача. <br>И в настройках отрубаем всю защиту нашей папки<br>
<img alt="Assets/Pasted image 20240712222534.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712222534.png"><br><br>У нас расшарена папка, роутер подключен к компьютеру по сети. Теперь берем и удерживаем кнопку reset на роутере, пока он не начнёт скачивать наш файл.<br>
(Процесс скачивание отобразится в окне программы)<br>После этого роутер перезагрузится и на какое-то время задумается. <br>Когда снова загорятся индикаторы включения и сети на роутере, можно будет приступать к установке openVPN клента.<br>Ахтунг! После сего действа не забудьте вернуть взад настройки IP на вашей сетевой карте, которые вы сделали до этого.<br><br>Если у нас всё прошло успешно, то по адресу <a data-tooltip-position="top" aria-label="http://192.168.1.1/" rel="noopener" class="external-link" href="http://192.168.1.1/" target="_blank">192.168.1.1</a> у нас будет доступна веб морда настроек роутера. Пытаемся открыть и видим вот такое окно:<br>
<img alt="Assets/Pasted image 20240712223050.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712223050.png"><br>Пользователь -- root<br>
Начальный пароль -- пустота<br>После первого захода роутер предложит придумать какой-нибудь пароль. Соглашаемся.<br><br>Если вы воткнули кабель напрямую от провайдера, то вам потребуется ввести всякие ваши логины и пароли во вкладке Network -&gt; Interfaces -&gt; WAN -&gt; Edit<br><img alt="Assets/Pasted image 20240712223651.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712223651.png"><br>В моём случае, я подключил кабель от другого роутера, там никакой защиты нет. <br><br>Идём во вкладку System -&gt; Software<br><img alt="Assets/Pasted image 20240712223616.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712223616.png"><br>Жмем на кнопку "Update Lists", и у нас выведется список доступных для установки программ. Вбиваем в поиск openvpn. И устанавливаем два пакета:<br><img alt="Assets/Pasted image 20240712224453.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712224453.png"><br>Первый -- сам клиент openVPN (это пакет openvpn-openssl или openvpn-mbedtls). Они ничем по поведению не отличаются. Разница лишь в библиотеках, которые они используют. <br>В моём случае openssl просто не помещался в память устройства, и я использовал другой)<br>Второй -- плагин, для того, чтобы у нас кнопочки по управлению VPN в вебморде появились.<br>Устанавливаем нажатием кнопок, сохраняемся, перезагружаем роутер через меню. (System -&gt; Reboot)<br><br>После всех проделанных махинаций в веб морде у нас появилась вкладка VPN.<br>Переходим в неё, удаляем все лишние стандартные записи, загружаем туда файл настроек VPN от вашего провайдера. <br><img alt="Assets/Pasted image 20240712225058.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712225058.png"><br><br>Чтобы забрасывать трафик в РФ можно купить <a data-tooltip-position="top" aria-label="https://vpn-naoborot.online/" rel="noopener" class="external-link" href="https://vpn-naoborot.online/" target="_blank">вот этот VPN</a> (выбирайте тариф "Быстрый")<br>Чтобы выбрасывать трафик из РФ в другие страны можно купить <a data-tooltip-position="top" aria-label="https://mullvad.net/en" rel="noopener" class="external-link" href="https://mullvad.net/en" target="_blank">вот этот VPN</a>. <br>Дальше следуя инструкциям от своего VPN провайдера, получаем кофиг-файл для openVPN, и загружаем на экран выше. <br>Прожимаем галочку "Enabled", нажимаем на "Start", потом сохраняемся. <br><br>Если до этого момента, из роутера неплохо шёл интернет, то он резко пропал. Ведь так?)<br>Дело в том, что прямой доступ к интернету теперь заблокирован впн-клиентом (что логично). А доступ через openVPN-посредника заблокирован фаерволом. Осталось рассказать ему, что это нужный трафик. <br>Идём в меню Network -&gt; Firewall -&gt; Настройки сети WAN -&gt; Edit<br>
<img alt="Assets/Pasted image 20240712225737.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712225737.png"><br>И во вкладке Advanced Settings в поле Covered devices проставляем галочку напротив tun0 (это и есть наш VPN туннель)<br>
<img alt="Assets/Pasted image 20240712225843.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712225843.png"><br>Сохраняемся, перезагружаемся, пробуем. <br>IP адрес и страну можно проверить <a data-tooltip-position="top" aria-label="https://2ip.ru/" rel="noopener" class="external-link" href="https://2ip.ru/" target="_blank">например здесь</a>.<br><img alt="Assets/Pasted image 20240712230057.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712230057.png"><br><br>Заходим в Network -&gt; Wireless -&gt; Edit<br><img alt="Assets/Pasted image 20240712230248.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712230248.png"><br>Mode -- Access Point<br>
SSID -- Имя вашей WIFI сетки<br>
Network -- Lan<br><img alt="Assets/Pasted image 20240712230216.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712230216.png"><br>Во вкладке Security<br>Encryption -- WPA2-PSK<br>
Cipher -- AES<br>
Key -- Ваш пароль от WIFI<br><img alt="Assets/Pasted image 20240712230613.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712230613.png"><br>Сохраняемся, применяем настройки, перезагружаемся. <br>Радуемся, что можем без какого-либо софта просто переключиться на другую WIFI точку и формально начать серфить интернет из-другой-страны. <br>&lt;/TL;DR&gt;<br><img alt="Assets/Pasted image 20240712230828.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712230828.png"><br>Всё<br>
<img alt="Assets/Pasted image 20240712230928.png" src="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712230928.png">]]></description><link>https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/как-заворачивать-трафик-в-vpn-на-уровне-роутера.html</link><guid isPermaLink="false">BlogPosts/Poduction/TLDR/VPN на роутере/Как заворачивать трафик в VPN на уровне роутера.md</guid><dc:creator><![CDATA[Roman A. Nosov]]></dc:creator><pubDate>Fri, 12 Jul 2024 19:27:30 GMT</pubDate><enclosure url="https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712215939.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src=&quot;https://nosoff.info/blogposts/poduction/tldr/vpn-на-роутере/assets/pasted-image-20240712215939.png&quot;&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[index]]></title><description><![CDATA[ 
 <br>Тут что-то будет. <br>Поскольку старый генератор блога, написанный мною на коленке мне больше не нравится, решил воспользоваться стандартным экспортом из Obisidian в HTML.<br>Ненуачо, выглядит прилично. Слева иерархия статей, смотри внимательно :)]]></description><link>https://nosoff.info/index.html</link><guid isPermaLink="false">index.md</guid><dc:creator><![CDATA[Roman A. Nosov]]></dc:creator><pubDate>Fri, 12 Jul 2024 19:31:23 GMT</pubDate></item></channel></rss>