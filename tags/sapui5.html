<!DOCTYPE html><html lang="ru"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="Nosoff.info — personal blog"/><title>Nosoff.info #sapui5</title><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/96d7ee85f27f33c47726.css" as="style"/><link rel="stylesheet" href="/_next/static/css/96d7ee85f27f33c47726.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-d2d57cb239f6bb2b989c.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.d2ae4074d0a54d95f68e.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.dc6404639596772c1856.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-ffab52136f2f93f6cd88.js" as="script"/><link rel="preload" href="/_next/static/chunks/bc82bb883724fe5faad984d18f20974d5cb6d361.96c096a4d39f0f83ca9f.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/tags/%5Btag%5D-032cac41ddf1bdd66924.js" as="script"/></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5"><section class="flex-col md:flex-row flex items-center md:justify-between mt-16 mb-16 md:mb-12"><h1 class="text-6xl md:text-8xl font-bold tracking-tighter leading-tight md:pr-8">Nosoff.info <!-- -->#sapui5</h1></section><section><div class="mb-8 md:mb-16"><div class="-mx-5 sm:mx-0"><a aria-label="Подключаем сторонние шрифты с иконками к SAPUI5-приложению" href="/posts/sapui5-connect-icons-font"><img src="/assets/blog/sapui5-connect-icons-font/background.jpg" alt="Cover Image for Подключаем сторонние шрифты с иконками к SAPUI5-приложению" class="shadow-small hover:shadow-medium transition-shadow duration-200"/></a></div></div><div class="md:col-gap-16 lg:col-gap-8 mb-20 md:mb-28"><div><h3 class="screenreader"><a class="hover:underline" href="/posts/sapui5-connect-icons-font">Подключаем сторонние шрифты с иконками к SAPUI5-приложению</a></h3><div class="mb-4 md:mb-0 text-lg"><time dateTime="2020-09-26T17:08:30.259Z">September	26, 2020</time></div></div><div><p class="text-lg leading-relaxed mb-4">Разберем процесс на примере шрифта от fontawesome</p><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div></div></section><section><h2 class="mb-8 text-6xl md:text-7xl font-bold tracking-tighter leading-tight">More Stories</h2><div class="grid grid-cols-1 md:grid-cols-2 md:col-gap-16 lg:col-gap-32 row-gap-20 md:row-gap-32 mb-32"><div><div class="mb-5"><div class="-mx-5 sm:mx-0"><a aria-label="Как запилить реактивность на SAPUI5 — часть 2" href="/posts/sapui5-state-part2"><img src="/assets/blog/sapui5-state-part2/backgroundWithHeader.png" alt="Cover Image for Как запилить реактивность на SAPUI5 — часть 2" class="shadow-small hover:shadow-medium transition-shadow duration-200"/></a></div></div><h3 class="screenreader"><a class="hover:underline" href="/posts/sapui5-state-part2">Как запилить реактивность на SAPUI5 — часть 2</a></h3><div class="text-lg mb-4"><time dateTime="2020-06-21T14:15:07.322Z">June	21, 2020</time></div><p class="text-lg leading-relaxed mb-4">Expression binding &amp; viewstate change handling</p><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div><div><div class="mb-5"><div class="-mx-5 sm:mx-0"><a aria-label="Как запилить реактивность на SAPUI5 — часть 1" href="/posts/sapui5-state"><img src="/assets/blog/sapui5-state/cover2withHeader.png" alt="Cover Image for Как запилить реактивность на SAPUI5 — часть 1" class="shadow-small hover:shadow-medium transition-shadow duration-200"/></a></div></div><h3 class="screenreader"><a class="hover:underline" href="/posts/sapui5-state">Как запилить реактивность на SAPUI5 — часть 1</a></h3><div class="text-lg mb-4"><time dateTime="2020-06-15T14:15:07.322Z">June	15, 2020</time></div><p class="text-lg leading-relaxed mb-4">Решил описать то, как можно удобно хранить состояния экранов (или всего приложения) внутри SAPUI5 и заниматься реактивностью (Почти как у больших и нормальных фреймворков)</p><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div></div></section></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"allPosts":[{"title":"Подключаем сторонние шрифты с иконками к SAPUI5-приложению","date":"2020-09-26T17:08:30.259Z","slug":"sapui5-connect-icons-font","author":{"name":"Roman A. Nosov","picture":"https://avatars3.githubusercontent.com/u/21103635?s=120\u0026v=4","url":"https://github.com/JustAddAcid"},"content":"\nПривет, мои маленькие любители лёгкого *БДСМ*. В эфире передача \"веселые истории с *SAPUI5*\". И сегодня мы рассмотрим, какие шаги нужно проделать, чтобы подключить шрифт с нужными нам иконками и использовать их при построении интерфейса. Тому що список стандартных иконок очень куцый, и иногда нужно добавить что-нибудь со стороны.\n\nКак и всегда это бывает в айтишечке, мы можем решить эту задачу целыми *двумя* способами:\n\n**Первый** — найти нормальную работу, и не маяться ерундой.\n\n![Нормальная работа](../public/assets/blog/sapui5-connect-icons-font/work_meme.jpg)\n\n**Второй** (сложнее, но не сильно) — описан ниже.\n\n## Немного теории\n\nНа [официальном демо-примере](https://sapui5.hana.ondemand.com/#/entity/sap.ui.core.Icon/sample/sap.ui.core.sample.Icon) можем посмотреть как работают нативные иконки в этом фреймворке. \n\nС точки зрения кода, иконки представлены классом sap.ui.core.**Icon**, остальные элементы экрана, в которых есть иконки, либо расширяют этот класс, либо содержат его внутри себя. Его конструктор принимает следующие основные аргументы:\n\n```xml\n\u003ccore:Icon\n  src=\"sap-icon://syringe\" путь до иконки с протоколом sap-icon\n  color=\"#031E48\" \u003e цвет\n\u003c/core:Icon\u003e\n```\n\nИ всё это чудо преобразовывается в следующую конструкцию при запуске:\n\n```html\n\u003cspan \n  role=\"presentation\" \n  aria-hidden=\"true\" \n  aria-label=\"syringe\" \n  data-sap-ui-icon-content=\"\" \n  class=\"sapUiIcon sapUiIconMirrorInRTL\" \n  style=\"font-family: 'SAP\\2dicons'; color: #031E48;\"\u003e\n  ::before\n\u003c/span\u003e\n```\n\n*SPAN*, в котором в аттрибуте style явно объявлен нативный шрифт с иконками, и цвет, заданный в XML-конструкторе. Сам символ иконки лежит в аттрибуте *data-sap-ui-icon-content*, который с помощью *css* подставляется внутрь псеводэлемента *::before*:\n\n```css\n.sapUiIcon::before{\n  content: attr(data-sap-ui-icon-content);\n  speak: none;\n  font-weight: normal;\n}\n```\n\nЗачем я это написал? Непонятно, т.к. в этой информации нет ничего полезного. \n\n![Для общего развития](../public/assets/blog/sapui5-connect-icons-font/для%20общего%20развития.jpg)\n\nПервым делом делаем что? Праавильно! [Лезем в доку](https://help.sap.com/saphelp_uiaddon10/helpdata/en/21/ea0ea94614480d9a910b2e93431291/content.htm?no_cache=true), где индусским по белому написано, что для использования кастомных шрифтов иконок нужно сделать несколько очень простых телодвижений:\n\n1. Объявить *font-face* с нашими шрифтами в *css*\n2. **Каждую** иконку, которую мы хотим использовать, нужно объявить с помощью метода sap.ui.core.IconPool.**addIcon**(iconName, collectionName, fontFamily, content)\n3. Ссылаться в на объявленные иконки во всех местах, где очень чешется по следующему принципу: **sap-icon**://\\[**collection-name**\\]/\\[**icon-name**\\]\n\nНа этом можно было заканчивать, но давайте пример.\n\n## Пример\n\nДля начала нам нужен какой-нибудь шрифт с иконками. Можно запаковать любые свои векторные изображения в шрифт, если очень хочется. Благо, для этого существует бесконечное количество утилит. Гуглите. \n\nЯ для примера буду пользовать готовую сборку иконок от [fontawesome](https://fontawesome.com). Залезаем, качаем архив с исходниками. В бесплатной версии нам доступны только шрифты: **brands**, **regular**, **solid**.\n\nВ директории */webfonts* собраны эти три шрифта в разных форматах. (Чтобы покрыть все популярные браузеры) -\u003e Копируем эту директорию в корень нашего проекта. \n\nДалее, идем по официальной инструкции:\n\nЧтобы объявить шрифты из *fontawesome* нужно с каждым из его шрифтов провернуть следующее:\n\n **Лезем в css проекта**.\n\n 1. Если нет .css файлов — создаём и объявляем его в manifest.json.\n   Путь объявления в манифесте:\n   ```JavaScript\n   {\n     \"sap.ui5\": {\n       \"resources\": {\n         \"css\": [\n           {\n             \"uri\": \"css/yourfilename.css\"\n           }\n         ]\n       }\n     }\n   }\n   ```\n 2. **Смотрим в файл** fontawesome/%fontname%.css\n 3. **Копируем блок** **@font-face**, в *css* проекта. Который будет примерно следующим:\n ```css\n @font-face {\n   font-family: 'Font Awesome 5 Free';\n   font-style: normal;\n   font-weight: 900;\n   font-display: block;\n   src: url(\"../webfonts/fa-solid-900.eot\");\n   src: url(\"../webfonts/fa-solid-900.eot?#iefix\") format(\"embedded-opentype\"), url(\"../webfonts/fa-solid-900.woff2\") format(\"woff2\"), url(\"../webfonts/fa-solid-900.woff\") format(\"woff\"), url(\"../webfonts/fa-solid-900.ttf\") format(\"truetype\"), url(\"../webfonts/fa-solid-900.svg#fontawesome\") format(\"svg\"); }\n ```\n 4. Где-нибудь в коде (например, при инициализации Component.js, и *желательно* в отдельном файле) добавляем нужные нам иконки в пул:\n ```JavaScript\n sap.ui.core.IconPool.addIcon(\"angry\", \"fa\", \"Font Awesome 5 Free\", \"f556\");\n sap.ui.core.IconPool.addIcon(\"gem\", \"fa\", \"Font Awesome 5 Free\", \"f3a5\");\n //...\n ```\n (Названия иконок и их символьные коды можно [подсмотреть на сайте](https://fontawesome.com/icons/gem?style=regular).)\n  \n 5. Используем иконки при декларации каких-нибудь элементов экрана:\n ```xml\n \u003cButton text=\"Очень красивая кнопка\"\n     icon=\"sap-icon://fa/gem\" /\u003e\n ```\n\n![Очень красивая кнопка](../public/assets/blog/sapui5-connect-icons-font/beautiful_button.jpg)\n\nКстати, названия всех иконок и их кодов удобно лежат в файле **/scss/_variables.scss**. И они вполне пригодны для автоматической обработки. Ну а шо, а вдруг.\n\n\u003ciframe width=\"100%\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/TeXk3RFy1rc\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen\u003e\u003c/iframe\u003e\n\n```scss\n// помимо других переменных, там содержатся $fa-var.* : code\n$fa-var-angry: \\f556;\n$fa-var-angrycreative: \\f36e;\n$fa-var-angular: \\f420;\n$fa-var-ankh: \\f644;\n$fa-var-app-store: \\f36f;\n//.......\n```\n\nНапример, можно автоматически собрать все команды добавления в пул. (Не пытайтесь засунуть всю портянку в проект, это просто пример.)\n\n```bash\ngrep -o fa-var.* ./_variables.scss \\\n | tr --delete \\;\\\\ | awk -F': ' \\\n '{print \"sap.ui.core.IconPool.addIcon(\\\"\"$1\"\\\",\\\"fa\\\",\\\"Font Awesome 5 Free\\\", \\\"\"$2\"\\\");\"}' \\\n \u003e iconDefinition.js\n```\n\nПолучим на выходе вот это:\n\n```JavaScript\nsap.ui.core.IconPool.addIcon(\"fa-var-address-card\",\"fa\",\"Font Awesome 5 Free\", \"f2bb\");\nsap.ui.core.IconPool.addIcon(\"fa-var-adjust\",\"fa\",\"Font Awesome 5 Free\", \"f042\");\nsap.ui.core.IconPool.addIcon(\"fa-var-adn\",\"fa\",\"Font Awesome 5 Free\", \"f170\");\nsap.ui.core.IconPool.addIcon(\"fa-var-adobe\",\"fa\",\"Font Awesome 5 Free\", \"f778\");\n//...\n```\n\nЦелый лонгрид о подключении шрифта... Ух.\n\n![Деградация](../public/assets/blog/sapui5-connect-icons-font/деградация.jpg)\n\nНа этом всё. Работает. \n\nP.S. При тестировании внутри **SAP WEB IDE** на **Internet Explorer** могут наблюдаться фантомные проблемы с отображением иконок. Но после деплоя — всё работает.\n\n#javascript #sapui5 ","ogImage":{"url":"/assets/blog/sapui5-connect-icons-font/background.jpg"},"coverImage":"/assets/blog/sapui5-connect-icons-font/background.jpg","issueId":"17","excerpt":"Разберем процесс на примере шрифта от fontawesome"},{"title":"Как запилить реактивность на SAPUI5 — часть 2","date":"2020-06-21T14:15:07.322Z","slug":"sapui5-state-part2","author":{"name":"Roman A. Nosov","picture":"https://avatars3.githubusercontent.com/u/21103635?s=120\u0026v=4","url":"https://github.com/JustAddAcid"},"content":"\nС концептом реактивности в *SAPUI5* немного разобрались. Осталось углубиться в эту тему чуть-чуть подробнее: \n\n1. Разобраться с тем, что же такое *expression binding* и с чем его едят\n2. А также ответить на вопрос — как подписываться на изменение *viewState* и выполнять по этому событию какой-либо код. \n\n![Добра поешь](../public/assets/blog/sapui5-state-part2/добра%20поешь.png)\n\n## Что же такое expression binding и с чем его едят\n\nВ прошлой статье я немного рассказывал о реактивности в *sapui5* и показывал пример привязки элементов экрана к данным. Если ещё не читали, то [добро пожаловать сюда](./sapui5-state).\n\nВ тех примерах байндинги описывались прямо в xml верстке. Примерно в таком формате:\n```xml\n\u003cControl property=\"{modelName\u003emodelProp}\"/\u003e\n```\nВ этом случае в свойство контрола автоматически будет попадать значение из модели и автоматически обновляться, если данные в модели изменились.\n\nНо это далеко не всё, что мы можем описать прямо во вью в декларативном стиле. Например, в некоторых ситуациях очень нужно именно **вычислять** значение поля на основании данных в модели, а не просто показывать какое-то значение.\n\n**Возможные сценарии:**\n\n1. Подкрашивать красным строки таблицы, где значение какого-нибудь столбца меньше нуля\n2. Активировать/деактивировать на основании данных кнопки\n3. Выводить количество записей в массиве и т.д.\n\n*Ремарка: сейчас речь пойдет только про *expression binding*. Про форматтеры поговорим как-нибудь в другой раз.*\n\nИ такой функционал вычисления свойств *sapui5* нам охотно может предоставить.\n\n```xml\n\u003cControl property=\"{= JS_CODE}\"/\u003e\n```\nВсё это выглядит следующим образом: сразу после открывающейся фигурной скобки вставляем знак равенства, так парсер понимает, что дальше будет какое-то вычисляемое поле на *js*. Далее можно поместить маленький кусок кода на *javaScript*, который будет выполняться при вычислении содержимого поля. \n\n*(Вставлять туда можно константы, вызовы функций, тренарные?операторы:, регэкспы и прочие прелести жизни.)*\n\nГлавное — не переусердствовать и не превратить разметку страницы в помойку. :)\n\nСсылаться на содержимое модели можно с помощью конструкции **${}**. Например: \n\n```xml\n\u003cText text=\"{= 'Hello, ' + ${user\u003ename}}\"\u003e\n```\nВ данном случае после *\"Hello, \"* будет подставлено *\"name\"* из модели *\"user\"*. И если в будущем поле **user\u003ename** изменится — автоматически произойдет повторное вычисление всех *expression bindings*, связанных с этим полем.\n\n**Ахтунг:**\nБудьте внимательны с *boolean*-атрибутами! \n```xml\n\u003cButton enabled=\"{= someFunction( ${model\u003eprop} )}\"\u003e\n```\nВ примере выше значение *enabled* (с типом *bool*) принимается из результата функции *someFunction*. Но если по каким-то причинам из функции возвратится **undefined**, то это значение **не будет** воспринято как *falsy* (как во всём остальном js), а мистическим образом конвертируется в **true**. Так что, конкретно в этом случае, может быть оправдана вот такая грязная и некрасивая запись (за которую вас могут ударить по рукам):\n```xml\n\u003cButton enabled=\"{= !!someFunction( ${model\u003eprop} )}\"\u003e\n\u003c!-- или --\u003e\n\u003cButton enabled=\"{= someFunction( ${model\u003eprop} ) ? true : false }\"\u003e\n```\n\nПопробую привести более полные и понятные примеры того, где эти *expression bindings* можно удобно использовать:\n\n### Раскрывающееся меню\n\nДопустим, нам требуется выпадающее меню вот с таким поведением: при нажатии на toggleButton должна меняться иконка и открываться дочерняя ветка меню. Как это сделать, почти не прибегая к *javaScript*?\n\n![menu closed](../public/assets/blog/sapui5-state-part2/menu%20closed.png)\n![menu opened](../public/assets/blog/sapui5-state-part2/menu%20opened.png)\n\nОчень просто: использовать для иконок тренарный оператор, который будет вычислять нужную нам иконку. А \"дочернюю\" ветку меню заключить в блок, который делать видимым тогда, когда свойство TransportEnabled в модели будет = true.\n\nПример верстки:\n\n```xml\n\u003cVBox\u003e\n  \u003cToggleButton text=\"Движение транспорта\"\n    icon=\"{= ${/TransportEnabled} ? 'иконка вкл' : 'иконка выкл'\"\n    pressed=\"{/TransportEnabled}\"/\u003e\n  \u003cVBox visible=\"{/TransportEnabled}\"\u003e\n    \u003cToggleButton text=\"В пути\" \n      icon=\"{= ${/TransportOnWay} ? 'иконка вкл' : 'иконка выкл'}\"\n      pressed=\"{/TransportOnWay}\"/\u003e\n    \u003cToggleButton text=\"На подходе\"\n      icon=\"{= ${/TransportApproaching} ? 'иконка вкл' : 'иконка выкл'}\"\n      pressed=\"{/TransportApproaching}\"/\u003e\n    \u003cToggleButton text=\"Прибыл\" \n      icon=\"{= ${/TransportArrived} ? 'иконка вкл' : 'иконка выкл'}\"\n      pressed=\"{/TransportArrived}\"/\u003e\n  \u003c/VBox\u003e\n\u003c/VBox\u003e\n```\n\n### Калькулятор\n\nДопустим, мы захотели написать простой калькулятор на *sapui5*. Как нам организовать блокировку кнопки \"decimal point\", когда точка уже введена пользователем? \n\n![calc before](../public/assets/blog/sapui5-state-part2/calc%20before.png)\n![calc after](../public/assets/blog/sapui5-state-part2/calc%20after.png)\n\n*Не сильно заметно, но на втором скрине кнопка с точкой заблокирована*\n\nМожно писать отдельный метод проверки, а можно сделать вот так:\n\n```xml\n\u003c!-- Само поле ввода чисел в калькулятор --\u003e\n\u003cInput enabled=\"false\" value=\"{viewState\u003e/input}\"/\u003e\n\n\u003c!-- ... --\u003e\n\n\u003cButton text=\".\" \n  press=\"appendSymbolToLine\" \n  enabled=\"{= !${viewState\u003e/input}.includes('.') }\"/\u003e\n```\n\nПросто проверять, есть ли в строке ввода точки :)\n\n**И напоследок расскажу, как привязывать хендлеры к изменению конкретного свойства в JSON-модели:**\n\nХитрость заключается в том, что если для этого мы будем использовать класс **sap.ui.model.Binding**, то у нас ничего хорошего не получится. Т.к. хендлер будет запускаться каждый раз, когда изменится **вообще какое-либо** поле в этой модели. \n\nА для привязки к конкретному полю существует специальный класс: **sap.ui.model.json.JSONPropertyBinding**.\n\nДавайте прикрутим к нашему калькулятору какой-нибудь хендлер изменения данных в модели. Например, будем рисовать toast-сообщение при записи значения в память нашего калькулятора (при нажатии кнопок M+ и M-)\n\nДля удобства напишем метод, который будет принимать два аргумента: путь до данных в модели, за которыми будем наблюдать, и функцию, которая будет запускаться при изменении этого поля:\n\n```javascript\n  addViewStateListener: function(path, callback) {\n    var oBinding = new sap.ui.model.json.JSONPropertyBinding(this.viewState, path);\n    oBinding.attachChange(callback);\n  }\n```\n\nЗатем напишем функцию, вызывающую сообщение и привяжем её к данным\n\n```javascript\n  memoryUsage: function(event){\n    sap.m.MessageToast.show(\"Memory usage! Set \" + event.getSource().getValue());\n  }\n\n// [....]\n  onInit: function() {\n  // [....]\n  // При инициализации привязываем нашу функцию к проперти модели\n  this.addViewStateListener(\"/memory\", this.memoryUsage);\n}\n```\n\nГотово! При нажатии на m+ получаем вот такое сообщение:\n\n![Calc handler](../public/assets/blog/sapui5-state-part2/calc_handler.jpg)\n\nКак всегда, код примера [вот здесь](https://github.com/JustAddAcid/sapui5-calculator)\n\nЕщё увидимся\n\n#javascript #sapui5 ","ogImage":{"url":"/assets/blog/sapui5-state-part2/backgroundWithHeader.png"},"coverImage":"/assets/blog/sapui5-state-part2/backgroundWithHeader.png","issueId":"11","excerpt":"Expression binding \u0026 viewstate change handling"},{"title":"Как запилить реактивность на SAPUI5 — часть 1","date":"2020-06-15T14:15:07.322Z","slug":"sapui5-state","author":{"name":"Roman A. Nosov","picture":"https://avatars3.githubusercontent.com/u/21103635?s=120\u0026v=4","url":"https://github.com/JustAddAcid"},"content":"\nРешил описать то, как можно удобно хранить состояния экранов (или всего приложения) внутри *SAPUI5* и делать реактивность (Почти как у больших и нормальных фреймворков).\n\n**Для тех, кто в танке и никогда не слышал, что это такое** *SAPUI5* — это фронтенд-фреймворк. Как  хипстерские *Vue* и *React*, только никому не нужен. Используется для быстрого написания фронтендов поверх выгрузки данных из SAP-ERP. \n\nВнезапно, но он действительно неплохо интегрирован со всей сап-экосистемой и простенькие приложения (внутри определенных рамок) писать не сильно больно. Проблемы начинаются тогда, когда нужно сделать что-то *большее*, чем просто нарисовать табличку с двумя кнопками. И внезапно вылезают всеобщая громоздкость синтаксиса, нестабильность работы некоторых контролов и отсутствие нормального комьюнити.\n\n![Learning programming sapui5](../public/assets/blog/sapui5-state/meme.png)\n\n## Стейты стейты стейты\n\n### Для начала немного теории\n\nЧто такое реактивное программирование очень хорошо объяснено [здесь](https://webdevblog.ru/ponimanie-reaktivnosti-vo-vue-js-shag-za-shagom/) только примеры для другого фреймворка. Но это не важно! :)\n\nВ основе лежит идея о том, что было бы очень неплохо, если бы контролы сами смотрели в данные и **перестраивались** бы автоматически, если что-нибудь в этих данных поменяется, без кучи явных хендлеров и присвоений значений в контролы по многу раз. \n\nИ наоборот — было бы неплохо, если бы данные **перестраивались** автоматически, если, например, в каком-нибудь input'e пользователь ввел другое значение.\n\n#### Вот такой вот интересный **two-way binding** ¯\\\\_(ツ)_/¯\n\nДавайте человеческим языком — суть в том, что все данные у нас сложены в одну коробку (массив/объект) и все контролы на странице рендерятся на основе этих данных. \n\nПлюсы здесь в том, что это, мать его, облегчает чтение и уменьшает размер нашего нелюбимого жабаскрипта. А чем меньше жабаскрипта — тем лучше.\n\nА ещё сразу понятно, что приложение делает, если взглянуть на модель данных. А ещё это кодится быстрее за ту же зарплату. Ну вы понимаете.\n\n### Разберем на практике избитый пример:\n\n#### Тудушница\n\nДавайте за минуту напишем простейший toDo-лист с единым хранением состояния. \n\nДля начала создаём пустое *SAPUI5* приложение с единственной view — *index.view.xml*, которая сразу при открытии будет отображаться пользователю. \n\nИдем от данных! Какие данные примерно должна хранить todo-list? Наверное, массив заметок с полями: checked, text, и id. Ну и содержимое текстового поля, которое генерирует новые заметки. Получилось примерно вот так:\n\n```javascript\n{\n    input: \"\",\n    todos: [\n    // Тут будут объекты вот в таком формате:\n    // \t{\n    // \tid: \"1\",\n    // \ttext: \"one\",\n    // \tchecked: true\n    // }\n    ]\n  }\n```\n\nСостояние в *SAPUI5* лучше всего хранить в объекте класса sap.ui.model.json.**JSONModel**. Он позволяет подписываться на изменения каждого из свойства хранимого объекта, - как из XML-view в декларативном стиле, так и напрямую писать хендлеры изменений из кода. Почему класс называется именно JSONModel - для меня остаётся загадкой, т.к. де-факто он хранит обычный JavaScript объект.\n\nОткрываем файл */controller/index.controller.js* и по событию инициализации создаём *JSON-model* и заполняем её данными.\n\n```javascript\n  onInit: function() {\n    this.viewState = new JSONModel({\n      input: \"\",\n      todos: []\n    });\n\n    this.getView().setModel(this.viewState, \"viewState\");\n  }\n```\n\nМодель присваивается к *View* с помощью метода *.setModel*. В данном конкретном случае псевдоним модели (\"*viewState*\") можно было не указывать, т.к. модель всего одна и путаницы возникнуть не может. \n\nДавайте попробуем представить, как бы у нас выглядел метод создания новой заметки:\n\n```javascript\n  appendTodo: function(){\n    var todos = this.viewState.getProperty(\"/todos\");\n    \n    this.viewState.setProperty(\"/todos\", todos.concat([{\n      id: new Date().getTime().toString(),\n      text: this.viewState.getProperty(\"/input\"),\n      checked: false\n    }]));\n    \n    this.viewState.setProperty(\"/input\", \"\");\n  },\n```\n\nОчень просто. Получение массива заметок, создание массива со старыми + новой заметкой и присвоение его к модели. Затем очистка поля ввода.\n\nВ качестве id нам пока вполне подойдет текущий таймстемп. Вместо Array.prototype.concat, если очень хочется, можно использовать ES6 spread operator:\n\n```javascript\n  const newArray = [...oldArray, newElement]\n```\n\nНо не очень нужно, т.к. у sapui5 из коробки нет никакого препроцессинга кода, а написанный энтузиастами плагин для Babel не для production-use. И используя фичи es6 мы автоматически делаем наш код неспособным запуститься на ie10-11 (а у некоторых он до сих пор — корпоративный стандарт).\n\nПереходим к разметке интерфейса. Там всё просто: поле создания заметок + список.\n\n```xml\n  \u003ccontent\u003e\n    \u003cInput value=\"{viewState\u003e/input}\" submit=\"appendTodo\"/\u003e\n    \u003cList items=\"{viewState\u003e/todos}\"\u003e\n      \u003citems\u003e\n        \u003cCustomListItem\u003e\n          \u003cHBox\u003e\n            \u003cCheckBox selected=\"{viewState\u003echecked}\"/\u003e\n            \u003cInput width=\"500px\" value=\"{viewState\u003etext}\"/\u003e\n            \u003cButton text=\"X\" press=\"deleteTodo\" data:id=\"{viewState\u003eid}\"/\u003e\n          \u003c/HBox\u003e\n        \u003c/CustomListItem\u003e\n      \u003c/items\u003e\n    \u003c/List\u003e\n  \u003c/content\u003e\n```\n\nID заметки будем передавать в data-* атрибуте. (Чтобы неймспейс data: в разметке заработал, нужно его подключить в самом верху view)\n\n```xml\n\u003cmvc:View \n  controllerName=\"todoTodo.controller.index\" \n  xmlns:html=\"http://www.w3.org/1999/xhtml\"\n  xmlns:mvc=\"sap.ui.core.mvc\"\n\tdisplayBlock=\"true\" \n  xmlns=\"sap.m\" \n  xmlns:data=\"http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1\"\u003e\n```\n\nМетод удаления заметки: Получаем id из data-* атрибута и фильтруем массив.\n\n```javascript\n  deleteTodo: function(event){\n    var id = event.getSource().data(\"id\");\n    var todos = this.viewState.getProperty(\"/todos\");\n    this.viewState.setProperty(\"/todos\", todos.filter(function(todo){\n      return todo.id !== id;\n    }));\n  }\n```\n\nЗапускаем — работает! Написано всего два простых метода. \n\nСейчас нам **ничего** не стоит забрать данные и записать в *localStorage* браузера, или отправить на *сервер*, или как-то обрабатывать в коде, т.к. мы всегда знаем, где находятся данные и как они организованы.\n\nА теперь давайте представим, сколько бы нам потребовалось геморроя, если бы мы писали это в классическом html+js... Приходилось бы руками описывать хендлеры событий каждого контрола, а сборка данных для отправки на сервер превратилась бы в сущий ад в виде цикла по всем контролам и вытаскивания значения. Конечно, для данного примера этот аргумент звучит не слишком сурово. Но представьте здоровенное *SPA* приложение с несколькими сотнями контролов в сложной иерархии...\n\nА пока - простейшее туду:\n\n![Запускаем — работает](../public/assets/blog/sapui5-state/basic-todo.png)\n\nВ представленном варианте: в модели *viewState* будет храниться объект со следующим содержанием:\n\n```javascript\n{\n    input: \"\"\n    todos: {\n        { id: \"1592739272730\", text: \"Раз\", checked: false }\n        { id: \"1592739273593\", text: \"Два\", checked: true }\n        { id: \"1592739274600\", text: \"Три\", checked: false }\n        { id: \"1592739276362\", text: \"Четыре\", checked: true }\n        { id: \"1592739277545\", text: \"Пять\", checked: false }\n    }\n}\n```\n\n[Репо с кодом](https://github.com/JustAddAcid/sapui5-todo)\n\nПродолжение следует.\n\n#javascript #sapui5","ogImage":{"url":"/assets/blog/sapui5-state/cover2withHeader.png"},"coverImage":"/assets/blog/sapui5-state/cover2withHeader.png","issueId":"10","excerpt":"Решил описать то, как можно удобно хранить состояния экранов (или всего приложения) внутри SAPUI5 и заниматься реактивностью (Почти как у больших и нормальных фреймворков)"}],"tag":"sapui5"},"__N_SSG":true},"page":"/tags/[tag]","query":{"tag":"sapui5"},"buildId":"2uw829RRDclewxBKKD3Kp","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-144e5fa6fafab6397d9c.js"></script><script src="/_next/static/chunks/main-d2d57cb239f6bb2b989c.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.d2ae4074d0a54d95f68e.js" async=""></script><script src="/_next/static/chunks/commons.dc6404639596772c1856.js" async=""></script><script src="/_next/static/chunks/pages/_app-ffab52136f2f93f6cd88.js" async=""></script><script src="/_next/static/chunks/bc82bb883724fe5faad984d18f20974d5cb6d361.96c096a4d39f0f83ca9f.js" async=""></script><script src="/_next/static/chunks/pages/tags/%5Btag%5D-032cac41ddf1bdd66924.js" async=""></script><script src="/_next/static/2uw829RRDclewxBKKD3Kp/_buildManifest.js" async=""></script><script src="/_next/static/2uw829RRDclewxBKKD3Kp/_ssgManifest.js" async=""></script></body></html>