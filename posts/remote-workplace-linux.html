<!DOCTYPE html><html lang="ru"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="Nosoff.info — personal blog"/><title>Организуем удалённое рабочее место на машине с linux</title><meta property="og:image" content="/assets/blog/remote-workplace-linux/logo.jpg"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/6a76aa4579e9e08b9326.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6a76aa4579e9e08b9326.css" data-n-g=""/><link rel="preload" href="/_next/static/css/660f735cfd0633f1a2b3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/660f735cfd0633f1a2b3.css" data-n-g=""/><link rel="preload" href="/_next/static/css/8991591a18319a912505.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8991591a18319a912505.css" data-n-p=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/_next/static/chunks/main-6957307470fcc6d1f962.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.9ec1f7868b3e9d138cdd.js" as="script"/><link rel="preload" href="/_next/static/chunks/022a8770.bca366718f045dbe8189.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.cb82874e43d6dd0d0fae.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-934682e3295d5f8e18d6.js" as="script"/><link rel="preload" href="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.2871a84b50d924fb6d88.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-7ac1586581b1f174a6dc.js" as="script"/></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">Nosoff.info</a></h2><article class="mb-32"><h1 class="screenreader">Организуем удалённое рабочее место на машине с linux</h1><div class="hidden md:block md:mb-12"><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div><div class="mb-8 md:mb-16 -mx-5 sm:mx-0"><div class="-mx-5 sm:mx-0"><img src="/assets/blog/remote-workplace-linux/logo.jpg" alt="Cover Image for Организуем удалённое рабочее место на машине с linux" class="shadow-small"/></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div><div class="mb-6 text-lg"><time dateTime="2020-06-07T14:15:07.322Z">June	7, 2020</time></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><p>На фоне эпидемии появилась необходимость в организации удобной удалённой работы на домашнем компьютере с ос <em>linux</em> на борту: настроить <em>rdp</em> клиент + <em>skype for business</em> (<em>lync</em>).</p>
<h3>Зачем?</h3>
<p>Не все работодатели готовы предоставлять работникам именно <em>VPN</em> для доступа к корпоративным сервисам. Лишь открывают RDP-терминал. Видимо, так им кажется безопаснее ¯\<em>(ツ)</em>/¯. А также, некоторые вещи физически невозможно развернуть на локальных машинах, так что в некоторых ситуациях протокол удалённых рабочих столов просто необходим.</p>
<h3>Как должно работать в идеале:</h3>
<ol>
<li>Нужен настроенный <em>RDP</em> клиент с поддержкой <em>gateways</em> на linux, который по одному клику открывает рабочий стол удалённой машины.</li>
<li>Нужна возможность созваниваться по skype for business с коллегами без огромных задержек от RDP. В идеале — запуск клиента на локальной машине.</li>
</ol>
<h2>Добываем себе возможность работать в трусах</h2>
<p><img src="/assets/blog/remote-workplace-linux/meme.jpg" alt="Удалёнка"></p>
<h3>RDP</h3>
<p>В качестве rdp клиента будем использовать <em>freerdp</em> — это один из немногих linux rdp клиентов, который поддерживает шлюзы (gateways). Устанавливаем:</p>
<pre><code class="language-bash">sudo apt instal freerdp
</code></pre>
<p>Теперь запускать удалённые rdp-сеансы мы можем с помощью консольной команды <strong>xfreerdp</strong>. С определенными параметрами:</p>
<p>Со всеми доступными параметрами можно <a href="https://github.com/FreeRDP/FreeRDP/wiki/CommandLineInterface" title="CommandLineInterface">познакомиться (здесь)</a>. Но нас интересуют вполне конкретные:</p>
<ol>
<li><strong>/f</strong> — fullscreen mode</li>
<li><strong>/multimon</strong> — поддержка нескольких мониторов</li>
<li><strong>/rfx</strong> — "расширенный" протокол поверх RDP. </li>
<li>(опционально) <strong>/sound:sys:alsa</strong> — включение стриминга звука на локальную машину</li>
<li><strong>+clipboard</strong> — расшаривание буфера обмена между удалённым рабочим столом и клиентской машиной</li>
<li><strong>+fonts</strong> — включить сглаживание шрифтов. </li>
<li><strong>/v</strong> — хост url</li>
<li><strong>/d</strong> — домен пользователя,</li>
<li><strong>/u</strong> — пользователь</li>
<li><strong>/p</strong> — пароль пользователя</li>
<li><strong>/g</strong> — шлюз url</li>
<li><strong>/gd</strong> — домен для авторизации на шлюзе</li>
<li><strong>/gu</strong> — пользователь для авторизации на шлюзе</li>
<li><strong>/gp</strong> — пароль для авторизации на шлюзе</li>
</ol>
<p>Итоговый скрипт запуска у нас будет следующим:</p>
<pre><code class="language-bash">#! /bin/bash

xfreerdp /v:targetUrl /d:domain /u:username /p:password /g:gateway /gd:domain /gu:username /gp:password /f /multimon /rfx /sound:sys:alsa +clipboard +fonts
</code></pre>
<p>Всё это можно сохранить в текстовом файле, сделать его исполняемым и положить для удобства на рабочий стол.</p>
<pre><code class="language-bash">sudo chmod +x filename #Сделать исполняемым
</code></pre>
<h3>Skype for business (lync)</h3>
<p>Несмотря на то, что порт обычной (не бизнесовой) версии скайпа  на линукс официально поставляется разработчиками — бизнесовой версии под linux <strong>нет</strong>. Браузерная версия Skype (<em>Skype web app</em>) тоже не заведется, т.к. для его функционирования нужно нативное windows-расширение для браузера. Как быть?</p>
<p>В этом нам поможет прекрасный плагин для мессенджеров — <a href="https://sipe.sourceforge.io/" title="A third-party Pidgin plugin for Microsoft LCS/OCS">SIPE</a>. Он позиционирует себя как open-source имплементация протокола OCS, по которому общаются клиенты <em>Skype for business</em>.</p>
<p>Установим pidgin + sipe</p>
<pre><code class="language-bash">sudo apt install pidgin pidgin-sipe
</code></pre>
<p>При создании учетных записей выбираем протокол "Office Communicator"
<img src="/assets/blog/remote-workplace-linux/pidgin-protocols.png" alt="Pidgin protocols list"></p>
<p>Вводим active directory login/e-mail/пароль. И вуаля! Подключается и работает.</p>
<p>Поскольку, это не официальный клиент, многие (не основные) функции могут отсутствовать. Но базовых более чем хватает:</p>
<ol>
<li>Чат</li>
<li>Звонки, как приватные, так и конференции. </li>
<li>Демонстрация рабочего стола</li>
<li>Совместное использование рабочего стола</li>
</ol>
</div></div></article><article class="mb-32 max-w-2xl mx-auto"><hr class="mb-5"/><h2 class="text-2xl md:text-2xl lg:text-2xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-center">Комментарии</h2><div class="md:flex p-6">Loading...</div><a href="https://github.com/JustAddAcid/JustAddAcid.github.io/issues/9" class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow mt-2 inline-block">Добавить комментарий</a></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Организуем удалённое рабочее место на машине с linux","date":"2020-06-07T14:15:07.322Z","slug":"remote-workplace-linux","author":{"name":"Roman A. Nosov","picture":"https://avatars3.githubusercontent.com/u/21103635?s=120\u0026v=4","url":"https://github.com/JustAddAcid"},"content":"\u003cp\u003eНа фоне эпидемии появилась необходимость в организации удобной удалённой работы на домашнем компьютере с ос \u003cem\u003elinux\u003c/em\u003e на борту: настроить \u003cem\u003erdp\u003c/em\u003e клиент + \u003cem\u003eskype for business\u003c/em\u003e (\u003cem\u003elync\u003c/em\u003e).\u003c/p\u003e\n\u003ch3\u003eЗачем?\u003c/h3\u003e\n\u003cp\u003eНе все работодатели готовы предоставлять работникам именно \u003cem\u003eVPN\u003c/em\u003e для доступа к корпоративным сервисам. Лишь открывают RDP-терминал. Видимо, так им кажется безопаснее ¯\\\u003cem\u003e(ツ)\u003c/em\u003e/¯. А также, некоторые вещи физически невозможно развернуть на локальных машинах, так что в некоторых ситуациях протокол удалённых рабочих столов просто необходим.\u003c/p\u003e\n\u003ch3\u003eКак должно работать в идеале:\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eНужен настроенный \u003cem\u003eRDP\u003c/em\u003e клиент с поддержкой \u003cem\u003egateways\u003c/em\u003e на linux, который по одному клику открывает рабочий стол удалённой машины.\u003c/li\u003e\n\u003cli\u003eНужна возможность созваниваться по skype for business с коллегами без огромных задержек от RDP. В идеале — запуск клиента на локальной машине.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003eДобываем себе возможность работать в трусах\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/assets/blog/remote-workplace-linux/meme.jpg\" alt=\"Удалёнка\"\u003e\u003c/p\u003e\n\u003ch3\u003eRDP\u003c/h3\u003e\n\u003cp\u003eВ качестве rdp клиента будем использовать \u003cem\u003efreerdp\u003c/em\u003e — это один из немногих linux rdp клиентов, который поддерживает шлюзы (gateways). Устанавливаем:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003esudo apt instal freerdp\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eТеперь запускать удалённые rdp-сеансы мы можем с помощью консольной команды \u003cstrong\u003exfreerdp\u003c/strong\u003e. С определенными параметрами:\u003c/p\u003e\n\u003cp\u003eСо всеми доступными параметрами можно \u003ca href=\"https://github.com/FreeRDP/FreeRDP/wiki/CommandLineInterface\" title=\"CommandLineInterface\"\u003eпознакомиться (здесь)\u003c/a\u003e. Но нас интересуют вполне конкретные:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e/f\u003c/strong\u003e — fullscreen mode\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e/multimon\u003c/strong\u003e — поддержка нескольких мониторов\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e/rfx\u003c/strong\u003e — \"расширенный\" протокол поверх RDP. \u003c/li\u003e\n\u003cli\u003e(опционально) \u003cstrong\u003e/sound:sys:alsa\u003c/strong\u003e — включение стриминга звука на локальную машину\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e+clipboard\u003c/strong\u003e — расшаривание буфера обмена между удалённым рабочим столом и клиентской машиной\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e+fonts\u003c/strong\u003e — включить сглаживание шрифтов. \u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e/v\u003c/strong\u003e — хост url\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e/d\u003c/strong\u003e — домен пользователя,\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e/u\u003c/strong\u003e — пользователь\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e/p\u003c/strong\u003e — пароль пользователя\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e/g\u003c/strong\u003e — шлюз url\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e/gd\u003c/strong\u003e — домен для авторизации на шлюзе\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e/gu\u003c/strong\u003e — пользователь для авторизации на шлюзе\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e/gp\u003c/strong\u003e — пароль для авторизации на шлюзе\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eИтоговый скрипт запуска у нас будет следующим:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e#! /bin/bash\n\nxfreerdp /v:targetUrl /d:domain /u:username /p:password /g:gateway /gd:domain /gu:username /gp:password /f /multimon /rfx /sound:sys:alsa +clipboard +fonts\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eВсё это можно сохранить в текстовом файле, сделать его исполняемым и положить для удобства на рабочий стол.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003esudo chmod +x filename #Сделать исполняемым\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eSkype for business (lync)\u003c/h3\u003e\n\u003cp\u003eНесмотря на то, что порт обычной (не бизнесовой) версии скайпа  на линукс официально поставляется разработчиками — бизнесовой версии под linux \u003cstrong\u003eнет\u003c/strong\u003e. Браузерная версия Skype (\u003cem\u003eSkype web app\u003c/em\u003e) тоже не заведется, т.к. для его функционирования нужно нативное windows-расширение для браузера. Как быть?\u003c/p\u003e\n\u003cp\u003eВ этом нам поможет прекрасный плагин для мессенджеров — \u003ca href=\"https://sipe.sourceforge.io/\" title=\"A third-party Pidgin plugin for Microsoft LCS/OCS\"\u003eSIPE\u003c/a\u003e. Он позиционирует себя как open-source имплементация протокола OCS, по которому общаются клиенты \u003cem\u003eSkype for business\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eУстановим pidgin + sipe\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003esudo apt install pidgin pidgin-sipe\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eПри создании учетных записей выбираем протокол \"Office Communicator\"\n\u003cimg src=\"/assets/blog/remote-workplace-linux/pidgin-protocols.png\" alt=\"Pidgin protocols list\"\u003e\u003c/p\u003e\n\u003cp\u003eВводим active directory login/e-mail/пароль. И вуаля! Подключается и работает.\u003c/p\u003e\n\u003cp\u003eПоскольку, это не официальный клиент, многие (не основные) функции могут отсутствовать. Но базовых более чем хватает:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eЧат\u003c/li\u003e\n\u003cli\u003eЗвонки, как приватные, так и конференции. \u003c/li\u003e\n\u003cli\u003eДемонстрация рабочего стола\u003c/li\u003e\n\u003cli\u003eСовместное использование рабочего стола\u003c/li\u003e\n\u003c/ol\u003e\n","ogImage":{"url":"/assets/blog/remote-workplace-linux/logo.jpg"},"coverImage":"/assets/blog/remote-workplace-linux/logo.jpg","issueId":"9"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"remote-workplace-linux"},"buildId":"Ky__88DxSP3T1MW1un6Xg","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-a98cee78eb8282e29fb6.js"></script><script src="/_next/static/chunks/main-6957307470fcc6d1f962.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.9ec1f7868b3e9d138cdd.js" async=""></script><script src="/_next/static/chunks/022a8770.bca366718f045dbe8189.js" async=""></script><script src="/_next/static/chunks/commons.cb82874e43d6dd0d0fae.js" async=""></script><script src="/_next/static/chunks/pages/_app-934682e3295d5f8e18d6.js" async=""></script><script src="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.2871a84b50d924fb6d88.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-7ac1586581b1f174a6dc.js" async=""></script><script src="/_next/static/Ky__88DxSP3T1MW1un6Xg/_buildManifest.js" async=""></script><script src="/_next/static/Ky__88DxSP3T1MW1un6Xg/_ssgManifest.js" async=""></script></body></html>