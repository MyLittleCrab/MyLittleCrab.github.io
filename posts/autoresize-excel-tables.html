<!DOCTYPE html><html lang="ru"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="Nosoff.info — personal blog"/><title>Авторесайз объединенных ячеек в EXCEL</title><meta property="og:image" content="/assets/blog/autoresize-excel-tables/background.jpg"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/482dfe6c028887e72df5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/482dfe6c028887e72df5.css" data-n-g=""/><link rel="preload" href="/_next/static/css/0c48cf1b27a1a692ad1c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0c48cf1b27a1a692ad1c.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-d2d57cb239f6bb2b989c.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.d2ae4074d0a54d95f68e.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.dc6404639596772c1856.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-f29bf15076b41d360505.js" as="script"/><link rel="preload" href="/_next/static/chunks/bc82bb883724fe5faad984d18f20974d5cb6d361.96c096a4d39f0f83ca9f.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-79475b7f53fb61a33277.js" as="script"/></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">Nosoff.info</a></h2><article class="mb-32"><h1 class="screenreader">Авторесайз объединенных ячеек в EXCEL</h1><div class="hidden md:block md:mb-12"><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div><div class="mb-8 md:mb-16 -mx-5 sm:mx-0"><div class="-mx-5 sm:mx-0"><img src="/assets/blog/autoresize-excel-tables/background.jpg" alt="Cover Image for Авторесайз объединенных ячеек в EXCEL" class="shadow-small"/></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div><div class="mb-6 text-lg"><time dateTime="2020-09-25T18:08:48.775Z">September	25, 2020</time></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><p>Прежде чем перейти к сути, давайте на минуточку остановимся и осознаем всю степень сюрреализма, который творится в государственном документообороте. Подумайте над тем, что если вы отправляете государству какую-то распечанную <em>EXCEL</em> табличку на бумажке(потому что именно так требует закон), то на принимающей стороне есть <strong>ОТДЕЛЬНЫЙ, МАТЬ ЕГО, ЧЕЛОВЕК</strong>, который руками забивает эти данные куда-то себе в базу!</p>
<p>Осознали? Прекрасно. Продолжаем.</p>
<iframe width="100%" height="315" src="https://www.youtube-nocookie.com/embed/lN-Y242GOgk" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Так уж исторически сложилось, что часто по работе люди встречаются со "стандартными" формами в <em>EXCEL</em>, которые нужно автоматически растягивать в зависимости от контента в ячейках. </p>
<p>Казалось бы, достаточно распространённая тема, по которой <strong>уйма</strong> информации в этих ваших интернетах. Но проводить по этому поводу ликбез мне уже приходилось несколько раз за последние пару месяцев. Так что, лучше <strong>записать</strong> это дерьмо, чтобы не повторять одно и то же. И потратить сэкономленное время на <del>прокрастинацию</del> более важные дела.</p>
<h2>Формулируем задачу</h2>
<p>Представим ситуацию, в которой есть какая-то программа, которая на основании данных в <em>БД</em> заполняет какой-то <em>ГОСТ</em>-овский <em>EXCEL</em>-темплейт данными, который в будущем кому-то отправляется и/или распечатывается. И в этой (уже абсурдной) ситуации совершенно никому не хочется тратить собственное время на растягивание ячеек вручную. И очень хочется как-то этот процесс автоматизировать.</p>
<h2>Чо делать?</h2>
<p><del>do a barrel roll</del></p>
<p>Ресайзить макросом, очевидно. Тут у нас два пути в зависимости от того, насколько над нами хотят поиздеваться окружающие:</p>
<h3>Самый простой вариант</h3>
<p>Это когда мы видим, что в документе напрочь отсутствуют объединённые ячейки, которые нужно ресайзить. А ресайзинг одиночных — <em>EXCEL</em> поддерживает нативно. Достаточно ругнуться на него вот такой командой:</p>
<pre><code class="language-vb">Cells.EntireRow.AutoFit ' Растянуть ячейки в высоту по контенту
' Или
Cells.EntireColumn.AutoFit ' Растянуть ячейки в ширину по контенту

' Или, на конкретную ячейку 
ОбъектЯчейки.EntireColumn/EntireRow.AutoFit 
</code></pre>
<h3>Вариант "как всегда"</h3>
<p>Но если вы читаете это, то скорее всего, у вас возникли сложности посерьёзнее. Вероятно, у вас самый обычный документ, в котором огромное количество связанных ячеек.</p>
<p><em>Що робити в цій ситуації?</em></p>
<p>Можно, конечно, попробовать изобрести очередной велосипед. А можно воспользоваться готовым кодом, который честно <del>спиз</del> сохранил из интернетов ваш покорный слуга.</p>
<p>Автором кода числится некий <strong>The_Prist (Щербаков Дмитрий)</strong> с сайта <a href="https://www.excel-vba.ru">excel-vba.ru</a>. Идея кода в том, что скрипт сначала временно отключает объединение ячеек, ресайзит первую ячейку с текстом нативными методами экселя, а затем объединяет ячейки обратно.</p>
<p>Получается достаточно просто и лаконично. Я лишь от себя добавил в код небольшой фикс, чтобы учитывались паддинги и масштабирование не "съезжало" при большом количестве ячеек.</p>
<p><a href="https://github.com/JustAddAcid/Excel_RowHeightForContent">Репозиторий с кодом можно найти здесь.</a></p>
<p>Как этим пользоваться:</p>
<ol>
<li>Проверить, что у вас тип файла с поддержкой макросов (с "m" на конце)</li>
<li>Залезть в <em>Вид</em> -> <em>Макросы</em> -> <em>Ввести %randomName%</em> -> <strong>Создать</strong></li>
<li>ПКМ по <em>Modules</em> -> <em>Insert</em> -> <strong>Module</strong></li>
<li>Скопировать содержимое файла <strong>RowHeightForContent.vb</strong> из <a href="https://github.com/JustAddAcid/Excel_RowHeightForContent">репозитория</a> в новый созданный модуль</li>
<li>Вызвать <strong>RowColHeightForContent</strong> с нужными ячейками. </li>
</ol>
<p>Но! Один вызов функции принимает в аргументы рейндж <strong>из одной</strong> связанной ячейки. Нельзя сразу выделить всю страницу и попытаться её отмасштабировать.  </p>
<p>Итоговый код вызова будет примерно вот таким</p>
<pre><code class="language-vb">' Две статичные ячейки
RowColHeightForContent ActiveWorkbook.Sheets(1).Range("S32")
RowColHeightForContent ActiveWorkbook.Sheets(1).Range("AV30")

Dim i As Integer

' Масштабирование строк в таблицах циклом
' На втором листе
i = 8
Do While Len(ActiveWorkbook.Sheets(2).Cells(i, 7).Value) > 0
    RowColHeightForContent ActiveWorkbook.Sheets(2).Cells(i, 7) ' Седьмой столбец
    RowColHeightForContent ActiveWorkbook.Sheets(2).Cells(i, 228) ' 228 столбец

    '(или вложенным циклом от N до M столбца)
    
    i = i + 1
Loop

' На третьем листе
i = 5
Do While Len(ActiveWorkbook.Sheets(3).Cells(i, 7).Value) > 0
    RowColHeightForContent ActiveWorkbook.Sheets(3).Cells(i, 7)
    i = i + 1
Loop
</code></pre>
<h2>Когда делать?</h2>
<p>По какому событию вызывать этот код? У нас не много вариантов: </p>
<ol>
<li>Если происходит заполнение темплейта через EXCEL-OLE API, то можно попробовать подвязаться на событие завершения сборки файла. (Тут нужно смотреть документацию вашего инструмента, который выгружает)</li>
<li>Во всех остальных случаях — можно выполнять код по событию <strong>"Открытие файла"</strong> (<em>Workbook_Open</em>).<ol>
<li>Для этого, нужно открыть модуль "Эта книга": <img src="../assets/blog/autoresize-excel-tables/this_book.png" alt="Эта книга"></li>
<li>Затем создать функцию <strong>Workbook_Open</strong> примерно вот так:</li>
</ol></li>
</ol>
<pre><code class="language-vb">Private Sub Workbook_Open()

' Здесь код ресайза

End Sub
</code></pre>
<p>В которую положить <del>болт</del> код ресайза нужных вам ячеек в документе. При открытии файла у пользователя будет всплывать запрос на разрешение выполнения макроса. И если он согласится — выбранные программистом ячейки будут растянуты по размеру содержимого. Собсна, всё.</p>
<h2>Послание читателю</h2>
<p>Возможно, я недостаточно раскрыл тему. Так что, если у вас остались вопросы — <del>гугл вам в помощь</del> прошу нафлудить в комментариях.</p>
<p>Всех благ</p>
<p><a href="/tags/excel">#excel</a> <a href="/tags/%D0%BE%D1%84%D0%B8%D1%81%D0%BD%D0%B0%D1%8F_%D0%B1%D0%BE%D0%BB%D1%8C">#офисная_боль</a></p>
</div></div></article><article class="mb-32 max-w-2xl mx-auto"><hr class="mb-5"/><h2 class="text-2xl md:text-2xl lg:text-2xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-center">Комментарии</h2><div class="md:flex p-6">Loading...</div><a href="https://github.com/JustAddAcid/JustAddAcid.github.io/issues/16" class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow mt-2 inline-block">Добавить комментарий</a></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Авторесайз объединенных ячеек в EXCEL","date":"2020-09-25T18:08:48.775Z","slug":"autoresize-excel-tables","author":{"name":"Roman A. Nosov","picture":"https://avatars3.githubusercontent.com/u/21103635?s=120\u0026v=4","url":"https://github.com/JustAddAcid"},"content":"\u003cp\u003eПрежде чем перейти к сути, давайте на минуточку остановимся и осознаем всю степень сюрреализма, который творится в государственном документообороте. Подумайте над тем, что если вы отправляете государству какую-то распечанную \u003cem\u003eEXCEL\u003c/em\u003e табличку на бумажке(потому что именно так требует закон), то на принимающей стороне есть \u003cstrong\u003eОТДЕЛЬНЫЙ, МАТЬ ЕГО, ЧЕЛОВЕК\u003c/strong\u003e, который руками забивает эти данные куда-то себе в базу!\u003c/p\u003e\n\u003cp\u003eОсознали? Прекрасно. Продолжаем.\u003c/p\u003e\n\u003ciframe width=\"100%\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/lN-Y242GOgk\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen\u003e\u003c/iframe\u003e\n\u003cp\u003eТак уж исторически сложилось, что часто по работе люди встречаются со \"стандартными\" формами в \u003cem\u003eEXCEL\u003c/em\u003e, которые нужно автоматически растягивать в зависимости от контента в ячейках. \u003c/p\u003e\n\u003cp\u003eКазалось бы, достаточно распространённая тема, по которой \u003cstrong\u003eуйма\u003c/strong\u003e информации в этих ваших интернетах. Но проводить по этому поводу ликбез мне уже приходилось несколько раз за последние пару месяцев. Так что, лучше \u003cstrong\u003eзаписать\u003c/strong\u003e это дерьмо, чтобы не повторять одно и то же. И потратить сэкономленное время на \u003cdel\u003eпрокрастинацию\u003c/del\u003e более важные дела.\u003c/p\u003e\n\u003ch2\u003eФормулируем задачу\u003c/h2\u003e\n\u003cp\u003eПредставим ситуацию, в которой есть какая-то программа, которая на основании данных в \u003cem\u003eБД\u003c/em\u003e заполняет какой-то \u003cem\u003eГОСТ\u003c/em\u003e-овский \u003cem\u003eEXCEL\u003c/em\u003e-темплейт данными, который в будущем кому-то отправляется и/или распечатывается. И в этой (уже абсурдной) ситуации совершенно никому не хочется тратить собственное время на растягивание ячеек вручную. И очень хочется как-то этот процесс автоматизировать.\u003c/p\u003e\n\u003ch2\u003eЧо делать?\u003c/h2\u003e\n\u003cp\u003e\u003cdel\u003edo a barrel roll\u003c/del\u003e\u003c/p\u003e\n\u003cp\u003eРесайзить макросом, очевидно. Тут у нас два пути в зависимости от того, насколько над нами хотят поиздеваться окружающие:\u003c/p\u003e\n\u003ch3\u003eСамый простой вариант\u003c/h3\u003e\n\u003cp\u003eЭто когда мы видим, что в документе напрочь отсутствуют объединённые ячейки, которые нужно ресайзить. А ресайзинг одиночных — \u003cem\u003eEXCEL\u003c/em\u003e поддерживает нативно. Достаточно ругнуться на него вот такой командой:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-vb\"\u003eCells.EntireRow.AutoFit ' Растянуть ячейки в высоту по контенту\n' Или\nCells.EntireColumn.AutoFit ' Растянуть ячейки в ширину по контенту\n\n' Или, на конкретную ячейку \nОбъектЯчейки.EntireColumn/EntireRow.AutoFit \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eВариант \"как всегда\"\u003c/h3\u003e\n\u003cp\u003eНо если вы читаете это, то скорее всего, у вас возникли сложности посерьёзнее. Вероятно, у вас самый обычный документ, в котором огромное количество связанных ячеек.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eЩо робити в цій ситуації?\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eМожно, конечно, попробовать изобрести очередной велосипед. А можно воспользоваться готовым кодом, который честно \u003cdel\u003eспиз\u003c/del\u003e сохранил из интернетов ваш покорный слуга.\u003c/p\u003e\n\u003cp\u003eАвтором кода числится некий \u003cstrong\u003eThe_Prist (Щербаков Дмитрий)\u003c/strong\u003e с сайта \u003ca href=\"https://www.excel-vba.ru\"\u003eexcel-vba.ru\u003c/a\u003e. Идея кода в том, что скрипт сначала временно отключает объединение ячеек, ресайзит первую ячейку с текстом нативными методами экселя, а затем объединяет ячейки обратно.\u003c/p\u003e\n\u003cp\u003eПолучается достаточно просто и лаконично. Я лишь от себя добавил в код небольшой фикс, чтобы учитывались паддинги и масштабирование не \"съезжало\" при большом количестве ячеек.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/JustAddAcid/Excel_RowHeightForContent\"\u003eРепозиторий с кодом можно найти здесь.\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eКак этим пользоваться:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eПроверить, что у вас тип файла с поддержкой макросов (с \"m\" на конце)\u003c/li\u003e\n\u003cli\u003eЗалезть в \u003cem\u003eВид\u003c/em\u003e -\u003e \u003cem\u003eМакросы\u003c/em\u003e -\u003e \u003cem\u003eВвести %randomName%\u003c/em\u003e -\u003e \u003cstrong\u003eСоздать\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eПКМ по \u003cem\u003eModules\u003c/em\u003e -\u003e \u003cem\u003eInsert\u003c/em\u003e -\u003e \u003cstrong\u003eModule\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eСкопировать содержимое файла \u003cstrong\u003eRowHeightForContent.vb\u003c/strong\u003e из \u003ca href=\"https://github.com/JustAddAcid/Excel_RowHeightForContent\"\u003eрепозитория\u003c/a\u003e в новый созданный модуль\u003c/li\u003e\n\u003cli\u003eВызвать \u003cstrong\u003eRowColHeightForContent\u003c/strong\u003e с нужными ячейками. \u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eНо! Один вызов функции принимает в аргументы рейндж \u003cstrong\u003eиз одной\u003c/strong\u003e связанной ячейки. Нельзя сразу выделить всю страницу и попытаться её отмасштабировать.  \u003c/p\u003e\n\u003cp\u003eИтоговый код вызова будет примерно вот таким\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-vb\"\u003e' Две статичные ячейки\nRowColHeightForContent ActiveWorkbook.Sheets(1).Range(\"S32\")\nRowColHeightForContent ActiveWorkbook.Sheets(1).Range(\"AV30\")\n\nDim i As Integer\n\n' Масштабирование строк в таблицах циклом\n' На втором листе\ni = 8\nDo While Len(ActiveWorkbook.Sheets(2).Cells(i, 7).Value) \u003e 0\n    RowColHeightForContent ActiveWorkbook.Sheets(2).Cells(i, 7) ' Седьмой столбец\n    RowColHeightForContent ActiveWorkbook.Sheets(2).Cells(i, 228) ' 228 столбец\n\n    '(или вложенным циклом от N до M столбца)\n    \n    i = i + 1\nLoop\n\n' На третьем листе\ni = 5\nDo While Len(ActiveWorkbook.Sheets(3).Cells(i, 7).Value) \u003e 0\n    RowColHeightForContent ActiveWorkbook.Sheets(3).Cells(i, 7)\n    i = i + 1\nLoop\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eКогда делать?\u003c/h2\u003e\n\u003cp\u003eПо какому событию вызывать этот код? У нас не много вариантов: \u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eЕсли происходит заполнение темплейта через EXCEL-OLE API, то можно попробовать подвязаться на событие завершения сборки файла. (Тут нужно смотреть документацию вашего инструмента, который выгружает)\u003c/li\u003e\n\u003cli\u003eВо всех остальных случаях — можно выполнять код по событию \u003cstrong\u003e\"Открытие файла\"\u003c/strong\u003e (\u003cem\u003eWorkbook_Open\u003c/em\u003e).\u003col\u003e\n\u003cli\u003eДля этого, нужно открыть модуль \"Эта книга\": \u003cimg src=\"../assets/blog/autoresize-excel-tables/this_book.png\" alt=\"Эта книга\"\u003e\u003c/li\u003e\n\u003cli\u003eЗатем создать функцию \u003cstrong\u003eWorkbook_Open\u003c/strong\u003e примерно вот так:\u003c/li\u003e\n\u003c/ol\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"language-vb\"\u003ePrivate Sub Workbook_Open()\n\n' Здесь код ресайза\n\nEnd Sub\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eВ которую положить \u003cdel\u003eболт\u003c/del\u003e код ресайза нужных вам ячеек в документе. При открытии файла у пользователя будет всплывать запрос на разрешение выполнения макроса. И если он согласится — выбранные программистом ячейки будут растянуты по размеру содержимого. Собсна, всё.\u003c/p\u003e\n\u003ch2\u003eПослание читателю\u003c/h2\u003e\n\u003cp\u003eВозможно, я недостаточно раскрыл тему. Так что, если у вас остались вопросы — \u003cdel\u003eгугл вам в помощь\u003c/del\u003e прошу нафлудить в комментариях.\u003c/p\u003e\n\u003cp\u003eВсех благ\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/tags/excel\"\u003e#excel\u003c/a\u003e \u003ca href=\"/tags/%D0%BE%D1%84%D0%B8%D1%81%D0%BD%D0%B0%D1%8F_%D0%B1%D0%BE%D0%BB%D1%8C\"\u003e#офисная_боль\u003c/a\u003e\u003c/p\u003e\n","ogImage":{"url":"/assets/blog/autoresize-excel-tables/background.jpg"},"coverImage":"/assets/blog/autoresize-excel-tables/background.jpg","issueId":"16"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"autoresize-excel-tables"},"buildId":"ZooAFQWCP1NJ0Vz-hqbN6","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-144e5fa6fafab6397d9c.js"></script><script src="/_next/static/chunks/main-d2d57cb239f6bb2b989c.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.d2ae4074d0a54d95f68e.js" async=""></script><script src="/_next/static/chunks/commons.dc6404639596772c1856.js" async=""></script><script src="/_next/static/chunks/pages/_app-f29bf15076b41d360505.js" async=""></script><script src="/_next/static/chunks/bc82bb883724fe5faad984d18f20974d5cb6d361.96c096a4d39f0f83ca9f.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-79475b7f53fb61a33277.js" async=""></script><script src="/_next/static/ZooAFQWCP1NJ0Vz-hqbN6/_buildManifest.js" async=""></script><script src="/_next/static/ZooAFQWCP1NJ0Vz-hqbN6/_ssgManifest.js" async=""></script></body></html>